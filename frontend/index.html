<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Mechanic Booking</title>
<style>
  /* Basic Reset & Layout */
  * { box-sizing: border-box; margin:0; padding:0; font-family: Arial, sans-serif; }
  body { background:#f9f9f9; }
  header { background:#222; color:#fff; padding:1rem; display:flex; justify-content:space-between; align-items:center; }
  header h1 { font-size:1.5rem; }
  header button { background:#f39c12; color:#fff; border:none; padding:.5rem 1rem; cursor:pointer; border-radius:4px; }
  main { padding:1rem; }
  .hero { text-align:center; padding:2rem 0; background:#3498db; color:#fff; border-radius:8px; margin-bottom:1rem; }
  .hero h2 { font-size:1.5rem; }
  .services-carousel { margin:1rem 0; overflow-x:auto; display:flex; gap:1rem; padding-bottom:1rem; }
  .service-card { flex:0 0 200px; background:#fff; padding:1rem; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
  .service-card h4 { font-size:1rem; margin-bottom:.5rem; }
  .booking-form { background:#fff; padding:1rem; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-top:1rem; }
  .booking-form input, .booking-form select, .booking-form button { width:100%; padding:.5rem; margin:.3rem 0; border-radius:4px; border:1px solid #ccc; }
  .booking-form button { background:#27ae60; color:#fff; border:none; cursor:pointer; }
  footer { position:fixed; bottom:0; left:0; width:100%; background:#222; color:#fff; text-align:center; padding:.5rem; }
  footer button { background:#f39c12; border:none; padding:.5rem 1rem; cursor:pointer; border-radius:4px; }

  /* Modal */
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
  .modal-content { background:#fff; padding:1rem; border-radius:8px; width:90%; max-width:400px; position:relative; }
  .modal-content .close { position:absolute; top:.5rem; right:.5rem; cursor:pointer; font-size:1.2rem; }

  /* Diagnostics panel */
  #diagnosticsPanel { display:none; position:fixed; bottom:0; left:0; width:100%; height:75%; background:#fff; overflow:auto; border-top-left-radius:8px; border-top-right-radius:8px; padding:1rem; box-shadow:0 -2px 10px rgba(0,0,0,0.2); }
</style>
</head>
<body>

<header>
  <h1>Mobile Mechanic SOS</h1>
  <button id="loginBtn">Login / Register</button>
</header>

<main>
  <section class="hero">
    <h2>Fast, Reliable Car Services at Your Door</h2>
  </section>

  <section class="services-carousel">
    <h3>Our Services</h3>
    <div id="carousel" style="display:flex; gap:1rem; overflow-x:auto;"></div>
  </section>

  <section class="booking-form">
    <h3>Book a Service</h3>
    <form id="bookingForm">
      <input type="number" name="customer_id" placeholder="Customer ID" required>
      <select name="service_id" required></select>
      <input type="text" name="location" placeholder="Location" required>
      <input type="text" name="postcode" placeholder="Postcode" required>
      <button type="submit">Book Now</button>
    </form>
  </section>
</main>

<footer>
  <button id="diagnosticsBtn">Diagnostics</button>
  <div id="diagnosticsPanel"></div>
</footer>

<!-- Login/Register Modal -->
<div id="authModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h3>Login / Register</h3>
    <form id="authForm">
      <input type="text" name="name" placeholder="Name" required>
      <input type="email" name="email" placeholder="Email" required>
      <input type="text" name="phone" placeholder="Phone" required>
      <input type="text" name="reg_plate" placeholder="Reg Plate" required>
      <input type="text" name="address" placeholder="Address" required>
      <button type="submit">Register</button>
    </form>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {

  // AUTH MODAL
  const authModal = document.getElementById("authModal");
  document.getElementById("loginBtn").onclick = ()=> authModal.style.display="flex";
  document.querySelector(".close").onclick = ()=> authModal.style.display="none";
  window.onclick = e => { if(e.target==authModal) authModal.style.display="none"; };

  // FETCH SERVICES
  const carousel = document.getElementById("carousel");
  const services = await fetch("/api/services").then(r=>r.json());
  const serviceSelect = document.querySelector("select[name='service_id']");
  services.forEach(s=>{
    const card = document.createElement("div");
    card.className="service-card";
    card.innerHTML=`<h4>${s.name}</h4><p>${s.description}</p>`;
    carousel.appendChild(card);
    const option=document.createElement("option");
    option.value=s.id; option.textContent=s.name;
    serviceSelect.appendChild(option);
  });

  // BOOKING FORM
  document.getElementById("bookingForm").addEventListener("submit", async e=>{
    e.preventDefault();
    const formData = Object.fromEntries(new FormData(e.target));
    const res = await fetch("/api/bookings",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(formData)});
    const data = await res.json();
    if(data.qr_code) alert("Booking Confirmed! QR Ticket Generated.");
  });

  // REGISTER CUSTOMER
  document.getElementById("authForm").addEventListener("submit", async e=>{
    e.preventDefault();
    const formData = Object.fromEntries(new FormData(e.target));
    const res = await fetch("/api/customers",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(formData)});
    const data = await res.json();
    if(data.id){ alert("Registered Successfully! Use ID to book services."); authModal.style.display="none"; }
    else alert("Error: "+JSON.stringify(data));
  });

  // DIAGNOSTICS
  const diagPanel = document.getElementById("diagnosticsPanel");
  document.getElementById("diagnosticsBtn").onclick=async ()=>{
    const data=await fetch("/api/diagnostics").then(r=>r.json());
    diagPanel.innerHTML=JSON.stringify(data,null,2);
    diagPanel.style.display="block";
  };
})();
</script>

</body>
</html>