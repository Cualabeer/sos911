<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customer Booking</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    display: flex;
    justify-content: center;
    padding: 2rem;
  }
  .booking-form {
    background: #fff;
    padding: 2rem;
    width: 90%;
    max-width: 500px;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 1.618rem; /* golden ratio spacing */
  }
  input, select, button {
    padding: 0.8rem 1rem;
    font-size: 1rem;
    border-radius: 8px;
    border: 1px solid #ccc;
    width: 100%;
    box-sizing: border-box;
  }
  button {
    background: #0074D9;
    color: white;
    font-weight: bold;
    border: none;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #005fa3;
  }
  #ticket {
    margin-top: 2rem;
    padding: 1rem;
    border: 2px solid #0074D9;
    border-radius: 8px;
    background: #e6f0ff;
    display: none;
  }
</style>
</head>
<body>
  <form class="booking-form" id="bookingForm">
    <input type="text" id="name" placeholder="Full Name" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="tel" id="phone" placeholder="Phone" required>
    <input type="text" id="vehicle" placeholder="Vehicle Registration (AB12CDE)" required>
    <select id="service" required>
      <option value="">Select Service</option>
      <option value="1">Oil Change</option>
      <option value="2">Brake Check</option>
      <option value="3">Battery Replacement</option>
      <option value="4">Tire Replacement</option>
      <option value="5">Full Service</option>
      <option value="6">AC Service</option>
      <option value="7">Wheel Alignment</option>
    </select>
    <input type="text" id="location" placeholder="Your Location" readonly required>
    <button type="button" onclick="getLocation()">Detect Location</button>
    <button type="submit">Book Service</button>
  </form>

  <div id="ticket"></div>

  <script>
    async function getLocation() {
      if (!navigator.geolocation) return alert('Geolocation not supported!');
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
        const data = await res.json();
        document.getElementById('location').value = data.display_name;
      }, (err) => alert('Error getting location: ' + err.message));
    }

    const form = document.getElementById('bookingForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = {
        customer_id: 1, // replace with real customer id
        vehicle_reg: document.getElementById('vehicle').value.toUpperCase(),
        service_id: document.getElementById('service').value,
        location: document.getElementById('location').value
      };
      const res = await fetch('https://sos911.onrender.com/bookings', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      const json = await res.json();
      if (json.booking) showTicket(json.booking);
      else alert('Booking failed!');
    });

    function showTicket(booking) {
      const ticket = document.getElementById('ticket');
      ticket.innerHTML = `
        <h3>Booking Ticket</h3>
        <p>Customer ID: ${booking.customer_id}</p>
        <p>Vehicle: ${booking.vehicle_reg}</p>
        <p>Service ID: ${booking.service_id}</p>
        <p>Location: ${booking.location}</p>
        <p>QR: ${booking.qr_code}</p>
      `;
      ticket.style.display = 'block';
    }
  </script>
</body>
</html>