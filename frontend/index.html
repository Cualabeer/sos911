<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Mechanic Booking</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512...YOUR_HASH..." crossorigin="anonymous" referrerpolicy="no-referrer" />
<style>
  body {margin:0;font-family:Arial,sans-serif;background:#f9f9f9;}
  header {background:#1E3A8A;color:white;padding:15px;text-align:center;}
  .hero {padding:20px;text-align:center;background:#3B82F6;color:white;}
  .services-carousel {display:flex;overflow-x:auto;scroll-behavior:smooth;padding:10px;}
  .service-card {min-width:200px;background:white;margin:0 10px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.2);padding:15px;text-align:center;}
  .service-card h3 {margin:10px 0 5px;}
  .service-card p {font-size:0.9em;color:#555;}
  .btn {background:#2563EB;color:white;padding:10px 15px;border:none;border-radius:5px;cursor:pointer;margin:5px;}
  .btn:hover {background:#1D4ED8;}
  /* Diagnostics panel */
  #diag-panel {position:fixed;bottom:-75%;left:0;width:100%;height:75%;background:#fff;box-shadow:0 -5px 15px rgba(0,0,0,0.3);overflow:auto;transition:bottom 0.5s ease;z-index:9999;}
  #diag-panel-header {padding:10px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #ccc;}
  #diag-content {padding:10px;}
  #diag-btn {position:fixed;bottom:10px;right:10px;z-index:1000;}
</style>
</head>
<body>

<header>
  <h1>Mobile Mechanic Booking</h1>
</header>

<div class="hero">
  <h2>Your car, our care!</h2>
  <p>Quick service bookings, transparent pricing, and loyalty rewards.</p>
</div>

<div class="services-carousel" id="services-carousel">
  <!-- Services will be populated here -->
</div>

<div style="text-align:center;margin:20px;">
  <button class="btn" onclick="openBookingForm()">Book Now</button>
</div>

<!-- Diagnostics Button -->
<button id="diag-btn" class="btn"><i class="fa fa-tools"></i> Run Diagnostics</button>

<!-- Diagnostics Panel -->
<div id="diag-panel">
  <div id="diag-panel-header">
    <strong>System Diagnostics</strong>
    <button id="diag-close" class="btn">Close</button>
  </div>
  <div id="diag-content"></div>
</div>

<script>
// Example: populate services carousel from API
async function loadServices() {
  try {
    const res = await fetch('/api/services');
    const services = await res.json();
    const carousel = document.getElementById('services-carousel');
    carousel.innerHTML = services.map(s => `
      <div class="service-card">
        <h3>${s.name}</h3>
        <p>${s.description || 'No description provided'}</p>
        <button class="btn" onclick="bookService(${s.id})">Book</button>
      </div>
    `).join('');
  } catch(err){
    console.error('Failed to load services', err);
  }
}

// Booking placeholder
function bookService(serviceId) {
  alert(`Service ${serviceId} selected. Booking form popup will appear.`);
}

// Diagnostics
async function runDiagnostics() {
  const diagnostics = [];
  const apis = ['services','bookings','customers'];
  for (const api of apis) {
    try {
      const res = await fetch(`/api/${api}`);
      const data = await res.json();
      diagnostics.push({name: api.toUpperCase() + ' API', status:'OK', items:data.length || ''});
    } catch(err) {
      diagnostics.push({name: api.toUpperCase() + ' API', status:'FAIL', error:err.message});
    }
  }
  return diagnostics;
}

async function showDiagnostics() {
  const results = await runDiagnostics();
  const content = document.getElementById('diag-content');
  content.innerHTML = results.map(d => `
    <div style="margin-bottom:5px;">
      <strong>${d.name}:</strong> ${d.status} ${d.items ? `(${d.items} items)` : ''}
      ${d.error ? `<span style="color:red">Error: ${d.error}</span>` : ''}
    </div>
  `).join('');
  document.getElementById('diag-panel').style.bottom = '0';
}

// Event listeners
document.getElementById('diag-btn').addEventListener('click', showDiagnostics);
document.getElementById('diag-close').addEventListener('click',()=>{document.getElementById('diag-panel').style.bottom='-75%';});

// Initial load
loadServices();

// Placeholder for booking form popup
function openBookingForm() {
  alert('Booking form popup opens here.');
}
</script>

</body>
</html>