<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Mechanic Booking</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; }
  header { background: #007bff; color: #fff; padding: 1rem; text-align:center; }
  .carousel-item { text-align:center; }
  .diagnostics-panel { 
    position: fixed; bottom: 0; left:0; right:0; height: 0; 
    background:#f8f9fa; overflow-y: auto; transition: height 0.3s ease;
    box-shadow: 0 -3px 6px rgba(0,0,0,0.1); padding:1rem;
  }
  .diagnostics-panel.open { height: 75%; }
  .footer-btn { position: fixed; bottom: 1rem; right:1rem; z-index:1000; }
  .modal-lg { max-width: 90%; }
</style>
</head>
<body>

<header>
  <h1>Mobile Mechanic Booking</h1>
  <button class="btn btn-light btn-sm" id="loginBtn">Login / Register</button>
</header>

<main class="container my-3">

  <!-- Service Carousel -->
  <div id="serviceCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
    <div class="carousel-inner" id="servicesContainer"></div>
    <button class="carousel-control-prev" type="button" data-bs-target="#serviceCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#serviceCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button>
  </div>

  <!-- Booking Form -->
  <div class="card p-3 mb-4">
    <h4>Book a Service</h4>
    <form id="bookingForm">
      <div class="mb-2">
        <input type="text" class="form-control" id="name" placeholder="Full Name" required>
      </div>
      <div class="mb-2">
        <input type="email" class="form-control" id="email" placeholder="Email" required>
      </div>
      <div class="mb-2">
        <input type="text" class="form-control" id="phone" placeholder="UK Phone 07xxxxxxxxx" required>
      </div>
      <div class="mb-2">
        <input type="text" class="form-control" id="reg_plate" placeholder="Car Reg Plate (UK)" required>
      </div>
      <div class="mb-2">
        <select class="form-select" id="serviceSelect" required></select>
      </div>
      <div class="mb-2">
        <input type="text" class="form-control" id="location" placeholder="Address" required>
      </div>
      <div class="mb-2">
        <input type="text" class="form-control" id="postcode" placeholder="Postcode" required>
      </div>
      <button type="submit" class="btn btn-primary w-100">Book Now</button>
    </form>
  </div>

</main>

<!-- Diagnostics Panel -->
<div class="diagnostics-panel" id="diagnosticsPanel">
  <h5>System Diagnostics</h5>
  <ul id="diagList"></ul>
  <button class="btn btn-secondary mt-2" id="closeDiagBtn">Close</button>
</div>
<button class="btn btn-warning footer-btn" id="openDiagBtn">Diagnostics</button>

<!-- QR Ticket Modal -->
<div class="modal fade" id="qrModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content p-3 text-center">
      <h5>Booking Confirmed!</h5>
      <p>Show this QR code to start your service.</p>
      <img id="qrCodeImg" src="" alt="QR Code">
      <button class="btn btn-primary mt-2" data-bs-dismiss="modal">Close</button>
    </div>
  </div>
</div>

<!-- Login/Register Modal -->
<div class="modal fade" id="loginModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-3">
      <h5>Login / Register</h5>
      <form id="loginForm">
        <input type="email" class="form-control mb-2" id="loginEmail" placeholder="Email" required>
        <input type="password" class="form-control mb-2" id="loginPassword" placeholder="Password" required>
        <button class="btn btn-primary w-100" type="submit">Login</button>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {

  const services = [
    {id:1,name:"Oil Change",desc:"Full synthetic oil change"},
    {id:2,name:"Brake Inspection",desc:"Check and adjust brakes"},
    {id:3,name:"Battery Replacement",desc:"Replace old battery"}
  ];

  const servicesContainer = document.getElementById("servicesContainer");
  const serviceSelect = document.getElementById("serviceSelect");
  services.forEach((s,i)=>{
    // Carousel items
    const div = document.createElement("div");
    div.className = "carousel-item" + (i===0?" active":"");
    div.innerHTML = `<h5>${s.name}</h5><p>${s.desc}</p>`;
    servicesContainer.appendChild(div);
    // Select options
    const opt = document.createElement("option");
    opt.value = s.id;
    opt.textContent = `${s.name} - ${s.desc}`;
    serviceSelect.appendChild(opt);
  });

  // Diagnostics toggle
  const diagPanel = document.getElementById("diagnosticsPanel");
  document.getElementById("openDiagBtn").addEventListener("click", ()=> diagPanel.classList.add("open"));
  document.getElementById("closeDiagBtn").addEventListener("click", ()=> diagPanel.classList.remove("open"));

  // Dummy diagnostics
  const diagList = document.getElementById("diagList");
  ["Database connected","Services API OK","Bookings API OK","Geolocation OK","QR Code OK"].forEach(d=>{
    const li = document.createElement("li");
    li.textContent = d; diagList.appendChild(li);
  });

  // Booking form
  document.getElementById("bookingForm").addEventListener("submit", e=>{
    e.preventDefault();
    const data = {
      customer_id:1,
      service_id:parseInt(serviceSelect.value),
      location:document.getElementById("location").value,
      postcode:document.getElementById("postcode").value
    };
    // Simulate backend booking
    const qrData = `booking:${data.customer_id}:${data.service_id}:${Date.now()}`;
    const qrImg = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(qrData)}&size=200x200`;
    document.getElementById("qrCodeImg").src = qrImg;
    new bootstrap.Modal(document.getElementById("qrModal")).show();
  });

  // Login/Register modal
  document.getElementById("loginBtn").addEventListener("click", ()=> {
    new bootstrap.Modal(document.getElementById("loginModal")).show();
  });

});
</script>
</body>
</html>