<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mobile Mechanic Booking</title>
<style>
  /* Reset & basic styling */
  body, html {margin:0;padding:0;font-family:Arial,sans-serif;}
  a {text-decoration:none;color:inherit;}
  button {cursor:pointer;}
  .hidden {display:none;}
  /* Header */
  header {background:#222;color:#fff;padding:1rem;display:flex;justify-content:space-between;align-items:center;}
  header h1 {margin:0;font-size:1.5rem;}
  header nav button {margin-left:0.5rem;}
  /* Hero */
  .hero {padding:2rem;text-align:center;background:#f4f4f4;}
  .hero h2 {margin-bottom:1rem;}
  .hero button {padding:0.75rem 1.5rem;font-size:1rem;background:#007BFF;color:#fff;border:none;border-radius:5px;}
  /* Services Carousel */
  .carousel-container {display:flex;overflow-x:auto;padding:1rem;gap:1rem;scroll-snap-type:x mandatory;}
  .carousel-item {min-width:200px;flex:0 0 auto;scroll-snap-align:start;background:#fff;padding:1rem;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.15);}
  .carousel-item h3 {margin-top:0;}
  /* Booking Form */
  .booking-form {background:#eee;padding:1rem;margin:1rem 0;border-radius:10px;}
  .booking-form input, .booking-form select {width:100%;margin:0.5rem 0;padding:0.5rem;}
  /* Modal */
  .modal-bg {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:100;}
  .modal {background:#fff;padding:2rem;border-radius:10px;max-width:400px;width:90%;}
  /* Diagnostics Footer */
  .diag-footer {position:fixed;bottom:0;width:100%;background:#222;color:#fff;max-height:80vh;overflow:auto;transition:transform 0.3s;transform:translateY(90%);}
  .diag-footer.open {transform:translateY(0);}
  .diag-footer-header {padding:1rem;cursor:pointer;background:#333;}
  .diag-footer-content {padding:1rem;}
</style>
</head>
<body>

<header>
  <h1>Mobile Mechanic</h1>
  <nav>
    <button id="loginBtn">Login</button>
    <button id="registerBtn">Register</button>
    <button id="profileBtn" class="hidden">Profile</button>
  </nav>
</header>

<section class="hero">
  <h2>Book Your Car Service Instantly</h2>
  <button id="bookNowBtn">Book Now</button>
</section>

<section class="services-carousel">
  <h2 style="text-align:center;">Our Services</h2>
  <div class="carousel-container" id="servicesCarousel">
    <!-- JS will populate services -->
  </div>
</section>

<section class="booking-form hidden" id="bookingForm">
  <h3>Book a Service</h3>
  <select id="serviceSelect"></select>
  <input type="text" id="location" placeholder="Enter your location">
  <input type="text" id="postcode" placeholder="Postcode">
  <button id="submitBooking">Confirm Booking</button>
</section>

<!-- Login Modal -->
<div class="modal-bg hidden" id="loginModal">
  <div class="modal">
    <h3>Login</h3>
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Password">
    <button id="loginSubmit">Login</button>
    <button onclick="closeModal('loginModal')">Cancel</button>
  </div>
</div>

<!-- Register Modal -->
<div class="modal-bg hidden" id="registerModal">
  <div class="modal">
    <h3>Register</h3>
    <input type="text" id="regName" placeholder="Full Name">
    <input type="email" id="regEmail" placeholder="Email">
    <input type="password" id="regPassword" placeholder="Password">
    <input type="text" id="regPhone" placeholder="Phone">
    <input type="text" id="regRegPlate" placeholder="Car Number Plate">
    <input type="text" id="regAddress" placeholder="Address">
    <button id="registerSubmit">Register</button>
    <button onclick="closeModal('registerModal')">Cancel</button>
  </div>
</div>

<!-- Diagnostics Footer -->
<div class="diag-footer" id="diagFooter">
  <div class="diag-footer-header" onclick="toggleDiagFooter()">Diagnostics</div>
  <div class="diag-footer-content" id="diagContent">
    Loading diagnostics...
  </div>
</div>

<script>
  // --- Utility functions ---
  function openModal(id){document.getElementById(id).classList.remove('hidden');}
  function closeModal(id){document.getElementById(id).classList.add('hidden');}
  function toggleDiagFooter(){document.getElementById('diagFooter').classList.toggle('open');}

  // --- Load Services ---
  async function loadServices(){
    const container = document.getElementById('servicesCarousel');
    try{
      const res = await fetch('/api/services');
      const services = await res.json();
      container.innerHTML = '';
      const select = document.getElementById('serviceSelect');
      select.innerHTML = '';
      services.forEach(s=>{
        container.innerHTML += `<div class="carousel-item"><h3>${s.name}</h3><p>${s.description}</p></div>`;
        select.innerHTML += `<option value="${s.id}">${s.name}</option>`;
      });
    } catch(e){console.error(e);}
  }

  // --- Load Diagnostics ---
  async function loadDiagnostics(){
    const diag = document.getElementById('diagContent');
    try{
      const res = await fetch('/api/diagnostics');
      const data = await res.json();
      diag.innerHTML = `<pre>${JSON.stringify(data,null,2)}</pre>`;
    } catch(e){diag.innerText='Diagnostics failed';}
  }

  // --- Event Listeners ---
  document.getElementById('loginBtn').addEventListener('click',()=>openModal('loginModal'));
  document.getElementById('registerBtn').addEventListener('click',()=>openModal('registerModal'));
  document.getElementById('bookNowBtn').addEventListener('click',()=>document.getElementById('bookingForm').classList.toggle('hidden'));

  // --- Booking Submit ---
  document.getElementById('submitBooking').addEventListener('click',async ()=>{
    const booking = {
      customer_id:1, // hardcoded for testing; integrate login
      service_id:parseInt(document.getElementById('serviceSelect').value),
      location:document.getElementById('location').value,
      postcode:document.getElementById('postcode').value
    };
    try{
      const res = await fetch('/api/bookings',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(booking)});
      const data = await res.json();
      alert('Booked! QR generated.'); // later show fullscreen ticket
    }catch(e){alert('Booking failed');}
  });

  loadServices();
  loadDiagnostics();
</script>

</body>
</html>